<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Shop Manager Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'coffee-primary': '#4B3832', // Dark Coffee Brown
                        'coffee-accent': '#C5A58E', // Light Tan/Beige
                        'coffee-light': '#F5F5F5',
                        'ready': '#10B981', // Emerald 500
                        'progress': '#FBBF24', // Amber 500
                        'waiting': '#3B82F6', // Blue 500
                        'cancelled': '#EF4444', // Red 500
                    }
                }
            }
        }
    </script>
    <!-- Load Lucide Icons for aesthetic appeal -->
    <script type="module">
        import 'https://unpkg.com/lucide@latest';
    </script>

    <!-- Custom Styles for clean card layout -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        /* Custom scrollbar for better look */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #C5A58E;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background-color: #E5E5E5;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, onSnapshot, updateDoc, deleteDoc, addDoc, query, where, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // IMPORTANT: Set debug level for firestore
        setLogLevel('Debug');

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'coffee-shop-manager';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;

        let db, auth;
        let userId = 'loading'; // Will be updated on auth state change
        const PUBLIC_COLLECTION_NAME = 'coffee_orders';

        // State variables
        let orders = [];
        let autoRefreshIntervalId = null;
        let autoRefreshTime = 0; // 0s (off) by default

        // --- Utility Data for Demo Orders ---
        const CUSTOMER_NAMES = ["Alex R.", "Sarah L.", "Omar K.", "Emily C.", "Ben M.", "Chloe P.", "David J.", "Fiona Z.", "Gavin H.", "Holly B."];
        const DRINK_ITEMS = ["Latte (Oat)", "Cappuccino", "Americano", "Iced Mocha", "Espresso (Dbl)", "Hot Chocolate", "Matcha Tea"];
        const FOOD_ITEMS = ["Croissant", "Blueberry Muffin", "Bagel w/ Cream Cheese", "Scone", "Almond Biscotti"];
        const SNACK_ITEMS = ["Sparkling Water", "Orange Juice", "Banana Bread Slice"];
        const PAYMENT_METHODS = ["Card", "Cash", "App"];

        // --- Core Firebase Initialization and Authentication ---

        /**
         * Initializes Firebase and authenticates the user.
         */
        const initializeFirebase = async () => {
            try {
                if (!firebaseConfig) {
                    console.error("Firebase config is missing. Cannot initialize Firestore.");
                    document.getElementById('db-status').textContent = "DB Error: Config Missing";
                    return;
                }
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                document.getElementById('db-status').textContent = "Connecting...";

                // Attempt to sign in with provided token, or anonymously if token is missing
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Set up real-time listener after auth is ready
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('db-status').textContent = "Online";
                        document.getElementById('user-id-display').textContent = `User: ${userId}`;
                        // Start listening for orders once authenticated
                        setupOrderListener();
                    } else {
                        userId = 'anonymous';
                        document.getElementById('db-status').textContent = "Offline (No Auth)";
                        document.getElementById('user-id-display').textContent = `User: ${userId} (Anon)`;
                    }
                });
            } catch (error) {
                console.error("Error initializing or authenticating Firebase:", error);
                document.getElementById('db-status').textContent = `DB Error: ${error.message}`;
            }
        };

        /**
         * Returns the correct Firestore collection reference (public path).
         * @returns {object} Firestore Collection Reference
         */
        const getOrdersCollection = () => {
            if (!db) {
                console.error("Firestore DB not initialized.");
                return null;
            }
            // Use the public path for shared live orders
            return collection(db, `artifacts/${appId}/public/data/${PUBLIC_COLLECTION_NAME}`);
        };


        // --- Real-time Order Listener ---

        /**
         * Sets up the real-time snapshot listener for the orders collection.
         */
        const setupOrderListener = () => {
            const ordersRef = getOrdersCollection();
            if (!ordersRef) return;

            // Simple query to order by timestamp descending
            // Note: Avoided use of query(..., orderBy('timestamp', 'desc')) to prevent potential index issues. 
            // We'll sort in memory.
            onSnapshot(ordersRef, (snapshot) => {
                const fetchedOrders = [];
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    fetchedOrders.push({
                        id: doc.id,
                        ...data,
                        // Ensure timestamp is a Date object for easy manipulation
                        timestamp: data.timestamp ? data.timestamp.toDate() : new Date(),
                    });
                });
                
                // Sort orders by time (newest first) in memory
                orders = fetchedOrders.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());

                renderDashboard();
                // Check for updates in local storage to update UI.
                checkAutoRefreshState();
            }, (error) => {
                console.error("Error listening to Firestore orders:", error);
                document.getElementById('db-status').textContent = `DB Error: Listener Failed`;
            });
        };

        // --- Utility Functions ---

        /**
         * Formats a Date object into a readable time string (HH:MM:SS).
         * @param {Date} date 
         * @returns {string} Formatted time string
         */
        const formatTime = (date) => {
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
        };

        /**
         * Calculates the duration since the order was placed in minutes.
         * @param {Date} timestamp 
         * @returns {number} Minutes elapsed
         */
        const minutesSince = (timestamp) => {
            const now = new Date();
            const diffInMilliseconds = now.getTime() - timestamp.getTime();
            return Math.floor(diffInMilliseconds / (1000 * 60));
        };

        /**
         * Gets Tailwind classes for status colors.
         * @param {string} status 
         * @returns {string} Tailwind classes
         */
        const getStatusClasses = (status) => {
            switch (status) {
                case 'ready':
                    return 'bg-ready text-white';
                case 'in progress':
                    return 'bg-progress text-coffee-primary';
                case 'waiting':
                    return 'bg-waiting text-white';
                case 'cancelled':
                    return 'bg-cancelled text-white opacity-70 line-through';
                default:
                    return 'bg-gray-400 text-white';
            }
        };

        /**
         * Generates a random order item list.
         * @returns {Array<string>} List of items
         */
        const generateRandomItems = () => {
            const items = [];
            const numDrinks = Math.floor(Math.random() * 3) + 1; // 1-3 drinks
            const numFood = Math.floor(Math.random() * 2); // 0-1 food
            const numSnack = Math.floor(Math.random() * 2); // 0-1 snack

            for (let i = 0; i < numDrinks; i++) {
                items.push(DRINK_ITEMS[Math.floor(Math.random() * DRINK_ITEMS.length)]);
            }
            for (let i = 0; i < numFood; i++) {
                items.push(FOOD_ITEMS[Math.floor(Math.random() * FOOD_ITEMS.length)]);
            }
            for (let i = 0; i < numSnack; i++) {
                items.push(SNACK_ITEMS[Math.floor(Math.random() * SNACK_ITEMS.length)]);
            }
            return items.length > 0 ? items : ["Filter Coffee"]; // Default item if empty
        };

        // --- Action Functions (CRUD on Firestore) ---

        /**
         * Adds a new demo order to Firestore.
         */
        window.addDemoOrder = async () => {
            const ordersRef = getOrdersCollection();
            if (!ordersRef) return;

            const items = generateRandomItems();
            const orderPrice = (items.length * 4.5 + Math.random() * 5).toFixed(2);
            
            const newOrder = {
                customerName: CUSTOMER_NAMES[Math.floor(Math.random() * CUSTOMER_NAMES.length)],
                items: items,
                status: 'waiting',
                payment: PAYMENT_METHODS[Math.floor(Math.random() * PAYMENT_METHODS.length)],
                totalPrice: parseFloat(orderPrice),
                timestamp: Timestamp.now(), // Firestore timestamp
                managerId: userId, // User who created the order (for tracking)
                isLargeGroup: items.length > 5, // Flag large orders
            };

            try {
                await addDoc(ordersRef, newOrder);
                console.log("Demo order added successfully.");
            } catch (error) {
                console.error("Error adding document: ", error);
            }
        };

        /**
         * Updates the status of an existing order in Firestore.
         * @param {string} orderId The document ID of the order.
         * @param {string} newStatus The new status ('waiting', 'in progress', 'ready', 'cancelled').
         */
        window.updateStatus = async (orderId, newStatus) => {
            const ordersRef = getOrdersCollection();
            if (!ordersRef) return;

            const orderDocRef = doc(ordersRef, orderId);
            try {
                await updateDoc(orderDocRef, {
                    status: newStatus
                });
                console.log(`Order ${orderId} status updated to ${newStatus}.`);
            } catch (error) {
                console.error("Error updating document: ", error);
            }
        };

        /**
         * Cancels an order by setting its status to 'cancelled'.
         * @param {string} orderId The document ID of the order.
         */
        window.cancelOrder = (orderId) => {
            window.updateStatus(orderId, 'cancelled');
        };

        // --- Auto-Refresh System ---

        /**
         * Starts or stops the auto-refresh interval.
         * @param {number} intervalSeconds The refresh interval in seconds (0 to turn off).
         */
        window.setAutoRefresh = (intervalSeconds) => {
            // Clear existing interval if present
            if (autoRefreshIntervalId) {
                clearInterval(autoRefreshIntervalId);
                autoRefreshIntervalId = null;
            }

            autoRefreshTime = intervalSeconds;

            // Only set a new interval if time is greater than 0
            if (intervalSeconds > 0) {
                const intervalMs = intervalSeconds * 1000;
                autoRefreshIntervalId = setInterval(() => {
                    // This function only triggers a re-render of local UI/calculations (alerts, summary)
                    // The main order list is handled by Firestore's onSnapshot.
                    renderAlerts();
                    renderAssistant();
                    renderSummary();
                    console.log(`Dashboard auto-refreshed (interval: ${intervalSeconds}s)`);
                }, intervalMs);
            }
            
            // Save state to local storage and update button text
            localStorage.setItem('autoRefreshTime', intervalSeconds.toString());
            updateAutoRefreshButtonState(intervalSeconds);
        };

        /**
         * Checks local storage on load to set the initial auto-refresh state.
         */
        const checkAutoRefreshState = () => {
            const savedTime = localStorage.getItem('autoRefreshTime');
            const interval = parseInt(savedTime, 10);
            if (!isNaN(interval) && interval >= 0) {
                window.setAutoRefresh(interval);
            } else {
                window.setAutoRefresh(0); // Default to off
            }
        }

        /**
         * Updates the styling of the auto-refresh buttons.
         * @param {number} currentInterval The currently active interval in seconds.
         */
        const updateAutoRefreshButtonState = (currentInterval) => {
            const buttons = document.querySelectorAll('.auto-refresh-btn');
            buttons.forEach(btn => {
                const btnInterval = parseInt(btn.dataset.interval, 10);
                if (btnInterval === currentInterval) {
                    btn.classList.remove('bg-gray-200', 'hover:bg-gray-300');
                    btn.classList.add('bg-coffee-accent', 'text-white');
                } else {
                    btn.classList.remove('bg-coffee-accent', 'text-white');
                    btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
                }
            });
            document.getElementById('refresh-status').textContent = currentInterval > 0 ? `${currentInterval}s` : 'OFF';
        };


        // --- Rendering Functions ---

        /**
         * Renders the entire dashboard: summary, orders, alerts, and assistant.
         */
        const renderDashboard = () => {
            renderSummary();
            renderOrders();
            renderAlerts();
            renderAssistant();
        };

        /**
         * Renders the summary bar with totals and counts.
         */
        const renderSummary = () => {
            // Filter out cancelled orders for operational counts/revenue
            const activeOrders = orders.filter(o => o.status !== 'cancelled');
            
            const totalOrders = orders.length;
            const readyCount = orders.filter(o => o.status === 'ready').length;
            const pendingCount = orders.filter(o => o.status === 'waiting' || o.status === 'in progress').length;
            const totalRevenue = activeOrders.reduce((sum, o) => sum + (o.totalPrice || 0), 0);
            
            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('ready-count').textContent = readyCount;
            document.getElementById('pending-count').textContent = pendingCount;
            document.getElementById('total-revenue').textContent = `$${totalRevenue.toFixed(2)}`;
        };

        /**
         * Renders the main grid of order cards.
         */
        const renderOrders = () => {
            const container = document.getElementById('orders-container');
            container.innerHTML = ''; // Clear previous orders

            if (orders.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-12 text-gray-500">No orders yet! Click 'Add Demo Order' to begin.</div>`;
                return;
            }

            orders.forEach((order) => {
                const statusClasses = getStatusClasses(order.status);
                const timeElapsed = minutesSince(order.timestamp);
                const isLongWait = order.status === 'waiting' && timeElapsed > 10;
                
                const card = document.createElement('div');
                card.className = `p-4 rounded-xl shadow-lg border-t-8 ${isLongWait ? 'border-red-500' : 'border-coffee-accent'} bg-white flex flex-col`;
                
                // Determine next status button text
                let nextStatusBtn;
                switch (order.status) {
                    case 'waiting':
                        nextStatusBtn = `<button onclick="updateStatus('${order.id}', 'in progress')" class="flex-1 bg-coffee-accent text-white py-1.5 rounded-lg hover:bg-coffee-primary transition duration-150">Start Order</button>`;
                        break;
                    case 'in progress':
                        nextStatusBtn = `<button onclick="updateStatus('${order.id}', 'ready')" class="flex-1 bg-ready text-white py-1.5 rounded-lg hover:bg-green-600 transition duration-150">Ready!</button>`;
                        break;
                    case 'ready':
                        nextStatusBtn = `<button disabled class="flex-1 bg-gray-400 text-white py-1.5 rounded-lg cursor-not-allowed">Completed</button>`;
                        break;
                    default: // Cancelled
                        nextStatusBtn = `<button disabled class="flex-1 bg-gray-400 text-white py-1.5 rounded-lg cursor-not-allowed">Cancelled</button>`;
                        break;
                }
                
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl font-bold text-coffee-primary truncate">${order.customerName}</h3>
                        <span class="text-sm font-semibold p-1 px-3 rounded-full ${statusClasses} uppercase">
                            ${order.status}
                        </span>
                    </div>

                    <div class="mb-3 text-sm text-gray-600 space-y-1">
                        <p class="flex items-center">
                            <i data-lucide="clock" class="w-4 h-4 mr-1 text-gray-500"></i>
                            <span class="font-medium">${formatTime(order.timestamp)}</span> 
                            (${timeElapsed} min ago)
                        </p>
                        <p class="flex items-center">
                            <i data-lucide="wallet" class="w-4 h-4 mr-1 text-gray-500"></i>
                            <span class="font-medium">${order.payment}</span> â€¢ 
                            <span class="text-lg font-extrabold ml-1 text-ready">$${order.totalPrice.toFixed(2)}</span>
                        </p>
                    </div>

                    <div class="flex-1 mb-4 border-t pt-2 mt-auto">
                        <p class="text-sm font-semibold text-gray-700 mb-1">Items (${order.items.length}):</p>
                        <ul class="list-disc list-inside text-sm text-gray-600 max-h-20 overflow-y-auto custom-scrollbar pr-2">
                            ${order.items.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="flex space-x-2 mt-auto pt-3 border-t">
                        ${nextStatusBtn}
                        ${order.status !== 'cancelled' ? `<button onclick="cancelOrder('${order.id}')" class="w-1/4 bg-red-100 text-red-600 py-1.5 rounded-lg hover:bg-red-200 transition duration-150" title="Cancel Order">
                            <i data-lucide="x-circle" class="w-5 h-5 mx-auto"></i>
                        </button>` : ''}
                    </div>
                `;
                container.appendChild(card);
            });

            // Re-initialize Lucide Icons for the new HTML content
            lucide.createIcons(); 
        };

        /**
         * Renders the alerts panel.
         */
        const renderAlerts = () => {
            const alertsContainer = document.getElementById('alerts-panel');
            alertsContainer.innerHTML = '';
            const alerts = [];
            const MAX_WAIT_MINUTES = 10;
            const LARGE_ORDER_ITEM_COUNT = 5;

            orders.forEach(order => {
                const timeElapsed = minutesSince(order.timestamp);
                
                // 1. Long Waiting Orders
                if (order.status === 'waiting' && timeElapsed > MAX_WAIT_MINUTES) {
                    alerts.push({
                        icon: 'timer-off',
                        color: 'text-red-600',
                        text: `${order.customerName}'s order has been **WAITING** for ${timeElapsed} minutes.`,
                        action: `updateStatus('${order.id}', 'in progress')`,
                        actionText: 'Start Now'
                    });
                }

                // 2. Large Group Orders
                if (order.items.length >= LARGE_ORDER_ITEM_COUNT && order.status !== 'cancelled' && order.status !== 'ready') {
                    alerts.push({
                        icon: 'users',
                        color: 'text-amber-500',
                        text: `${order.customerName} has a **LARGE** order (${order.items.length} items). Prioritize prep.`,
                        action: null,
                        actionText: null
                    });
                }
                
                // 3. Recently Cancelled Orders
                if (order.status === 'cancelled' && minutesSince(order.timestamp) < 60) {
                     alerts.push({
                        icon: 'trash-2',
                        color: 'text-gray-500',
                        text: `${order.customerName}'s order was **CANCELLED** at ${formatTime(order.timestamp)}.`,
                        action: null,
                        actionText: null
                    });
                }
            });

            if (alerts.length === 0) {
                alertsContainer.innerHTML = `<div class="text-gray-500 text-center py-4">All clear! No urgent issues detected.</div>`;
                return;
            }

            alerts.slice(0, 5).forEach(alert => { // Show max 5 alerts
                const alertEl = document.createElement('div');
                alertEl.className = 'flex items-center justify-between p-3 rounded-lg bg-white shadow-sm mb-2 border-l-4 border-red-400';
                
                alertEl.innerHTML = `
                    <div class="flex items-center mr-2">
                        <i data-lucide="${alert.icon}" class="w-5 h-5 ${alert.color} mr-2 flex-shrink-0"></i>
                        <p class="text-sm text-gray-700">${alert.text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>
                    </div>
                    ${alert.action ? `<button onclick="${alert.action}" class="flex-shrink-0 ml-2 text-xs font-semibold px-2 py-1 bg-red-100 text-red-600 rounded-md hover:bg-red-200 transition duration-150">${alert.actionText}</button>` : ''}
                `;
                alertsContainer.appendChild(alertEl);
            });
            lucide.createIcons();
        };

        /**
         * Renders the Smart Assistant panel with suggestions.
         */
        const renderAssistant = () => {
            const assistantContainer = document.getElementById('assistant-panel');
            
            if (orders.length === 0) {
                assistantContainer.textContent = "Assistant: Waiting for first order data...";
                return;
            }

            // 1. Analyze popular items in waiting/in-progress queue
            const activeOrders = orders.filter(o => o.status === 'waiting' || o.status === 'in progress');
            const itemCounts = {};
            activeOrders.forEach(order => {
                order.items.forEach(item => {
                    itemCounts[item] = (itemCounts[item] || 0) + 1;
                });
            });

            const topItems = Object.entries(itemCounts)
                .sort(([, countA], [, countB]) => countB - countA)
                .slice(0, 3);

            let suggestion = "Assistant: All systems nominal. Keep up the great work!";

            if (topItems.length > 0) {
                const [topItem, topCount] = topItems[0];
                if (topCount >= 4) {
                    suggestion = `Assistant: **HIGH DEMAND ALERT**: We have ${topCount} orders for **${topItem}** in the queue. Consider prepping a bulk batch now.`;
                } else if (topCount >= 2 && topCount <= 3) {
                    suggestion = `Assistant: **Suggestion**: ${topItem} is currently popular (${topCount} orders). Ensure ingredients are stocked.`;
                }
            }

            // 2. Analyze overall flow
            const readyCount = orders.filter(o => o.status === 'ready').length;
            const waitingCount = orders.filter(o => o.status === 'waiting').length;
            
            if (waitingCount > readyCount * 2 && waitingCount > 5) {
                suggestion = `Assistant: **Slowing Down**: Waiting orders (${waitingCount}) are piling up significantly faster than 'Ready' orders (${readyCount}). Re-allocate staff to the queue!`;
            }


            assistantContainer.innerHTML = suggestion.replace(/\*\*(.*?)\*\*/g, '<strong class="text-coffee-primary">$1</strong>');
        };

        // --- Initial Setup on Load ---

        window.onload = () => {
            // Initialize Firebase and start the real-time listener
            initializeFirebase();
            
            // Set up button listeners for auto-refresh
            document.querySelectorAll('.auto-refresh-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const interval = parseInt(btn.dataset.interval, 10);
                    window.setAutoRefresh(interval);
                });
            });
        };
    </script>

    <!-- Header -->
    <header class="bg-coffee-primary text-white shadow-lg p-4 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-extrabold flex items-center">
                <i data-lucide="coffee" class="w-7 h-7 mr-2 text-coffee-accent"></i>
                Manager Dashboard
            </h1>
            <div class="flex items-center text-sm space-x-4">
                <span id="user-id-display" class="font-medium bg-coffee-accent px-3 py-1 rounded-full">User: Loading</span>
                <span id="db-status" class="font-bold">Status: Loading...</span>
            </div>
        </div>
    </header>

    <main class="flex-1 p-4 md:p-8 max-w-7xl mx-auto w-full">

        <!-- Summary & Controls Bar -->
        <div class="grid grid-cols-2 lg:grid-cols-6 gap-4 mb-8">
            
            <!-- Summary Cards -->
            <div class="lg:col-span-1 p-4 bg-white rounded-xl shadow-md border-b-4 border-coffee-accent">
                <p class="text-sm font-medium text-gray-500">Total Orders</p>
                <p id="total-orders" class="text-3xl font-bold text-coffee-primary">0</p>
            </div>
            <div class="p-4 bg-white rounded-xl shadow-md border-b-4 border-ready">
                <p class="text-sm font-medium text-gray-500">Ready</p>
                <p id="ready-count" class="text-3xl font-bold text-ready">0</p>
            </div>
            <div class="p-4 bg-white rounded-xl shadow-md border-b-4 border-waiting">
                <p class="text-sm font-medium text-gray-500">Pending</p>
                <p id="pending-count" class="text-3xl font-bold text-waiting">0</p>
            </div>
            <div class="lg:col-span-1 p-4 bg-white rounded-xl shadow-md border-b-4 border-progress">
                <p class="text-sm font-medium text-gray-500">Total Revenue</p>
                <p id="total-revenue" class="text-3xl font-bold text-coffee-primary">$0.00</p>
            </div>
            
            <!-- Action Controls -->
            <div class="lg:col-span-2 col-span-2 p-4 bg-white rounded-xl shadow-md flex flex-col justify-between">
                <button onclick="addDemoOrder()" class="w-full bg-green-500 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-green-600 transition duration-200 flex items-center justify-center">
                    <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                    Add Demo Order
                </button>

                <div class="mt-3 flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700 mr-2">Auto-Refresh: <span id="refresh-status" class="font-bold text-coffee-primary">OFF</span></span>
                    <div class="flex space-x-1">
                        <button class="auto-refresh-btn text-xs px-2 py-1 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-150" data-interval="0">OFF</button>
                        <button class="auto-refresh-btn text-xs px-2 py-1 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-150" data-interval="5">5s</button>
                        <button class="auto-refresh-btn text-xs px-2 py-1 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-150" data-interval="10">10s</button>
                        <button class="auto-refresh-btn text-xs px-2 py-1 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-150 hidden sm:inline-block" data-interval="30">30s</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Main Content Grid: Orders & Alerts/Assistant -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Order Cards Grid -->
            <div class="lg:col-span-2">
                <h2 class="text-2xl font-semibold text-coffee-primary mb-4 border-b pb-2">Live Orders Queue</h2>
                <div id="orders-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Order cards will be injected here by renderOrders() -->
                    <div class="col-span-full text-center py-12 text-gray-500">Loading orders...</div>
                </div>
            </div>

            <!-- Alerts & Assistant Panel -->
            <div class="lg:col-span-1 space-y-8">
                
                <!-- Alerts Panel -->
                <div class="bg-white rounded-xl shadow-lg p-5">
                    <h3 class="text-xl font-semibold text-red-600 flex items-center mb-3 border-b pb-2">
                        <i data-lucide="bell-ring" class="w-5 h-5 mr-2"></i>
                        Urgent Alerts
                    </h3>
                    <div id="alerts-panel">
                        <!-- Alerts will be injected here by renderAlerts() -->
                        <div class="text-gray-500 text-center py-4">Loading alerts...</div>
                    </div>
                </div>

                <!-- Smart Assistant Panel -->
                <div class="bg-coffee-light rounded-xl shadow-lg p-5 border-l-4 border-coffee-primary">
                    <h3 class="text-xl font-semibold text-coffee-primary flex items-center mb-3">
                        <i data-lucide="cpu" class="w-5 h-5 mr-2"></i>
                        Smart Assistant
                    </h3>
                    <p id="assistant-panel" class="text-sm text-gray-700 leading-relaxed">
                        Assistant: Analyzing order flow...
                    </p>
                </div>

            </div>
        </div>

    </main>
</body>
</html>
